<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxia Interactiva de Corazones 3D</title>
    <!-- Carga Tailwind CSS para el banner de instrucciones -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga Three.js y OrbitControls para la escena 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        /* Estilos base de la aplicaci√≥n */
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #000010; /* Fondo azul muy oscuro */
            font-family: 'Inter', sans-serif;
            color: white;
        }
        canvas { 
            display: block; 
            width: 100vw; 
            height: 100vh; 
        }
        #instructions {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            pointer-events: none; /* Permite interactuar con el canvas debajo */
            z-index: 10;
        }
        #music-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 10;
        }
        .music-btn {
            background: rgba(139, 92, 246, 0.8);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        .music-btn:hover {
            background: rgba(124, 58, 237, 0.9);
            transform: scale(1.1);
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        #zoom-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            text-align: center;
            z-index: 10;
            pointer-events: none;
            opacity: 0.9;
            transition: opacity 3s ease;
        }
    </style>
</head>
<body>

    <!-- Contenedor de las instrucciones -->
    <div id="instructions" class="p-4 text-center">
        <div class="bg-indigo-900/70 p-4 rounded-xl shadow-lg max-w-sm mx-auto">
            <p class="text-sm font-semibold">
                üåå ¬°Explora tu Galaxia de Amor!
            </p>
            <p class="text-xs mt-1 text-gray-300">
                Usa el <strong>rat√≥n</strong> para rotar y la <strong>rueda</strong> para hacer zoom.
            </p>
        </div>
    </div>

    <!-- Indicador de zoom -->
    <div id="zoom-hint">
        üîç Ac√©rcate al centro para descubrir un mensaje especial
    </div>

    <!-- Controles de m√∫sica -->
    <div id="music-controls">
        <button id="playBtn" class="music-btn pulse">üéµ</button>
        <button id="pauseBtn" class="music-btn" style="display: none;">‚è∏Ô∏è</button>
    </div>

    <!-- Audio para la canci√≥n -->
    <audio id="backgroundMusic" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/11/22/audio_aa0e27b8a6.mp3?filename=magical-love-193175.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
    </audio>

    <script>
        // Array de textos y emojis para poblar la galaxia
        const messages = [
            "TE AMO", 
            "My love", 
            "Eres preciosa", 
            "Me encantas", 
            "Amor de mi vida", 
            "Para Ti", 
            "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è",
            "Mi Sol",
            "Siempre juntos",
            "Mi coraz√≥n",
            "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", "‚ù§Ô∏è", 
            "Eterno", "Felicidad",
            "Mi Coraz√≥n",
            "Encantado",
            "Eres m√°gica",
            "Amor eterno",
            "Universos",
            "Constelaciones",
            "Susurros",
            "Estrella",
            "Perfecto"
        ];
        
        // --- CONTROL DE M√öSICA ---
        const backgroundMusic = document.getElementById('backgroundMusic');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const zoomHint = document.getElementById('zoom-hint');

        // Control de m√∫sica
        playBtn.addEventListener('click', function() {
            backgroundMusic.play().catch(e => {
                console.log("La reproducci√≥n autom√°tica fue prevenida:", e);
                alert("Por favor haz clic en cualquier parte de la pantalla primero, luego en el bot√≥n de m√∫sica para reproducir.");
            });
            playBtn.style.display = 'none';
            pauseBtn.style.display = 'block';
        });

        pauseBtn.addEventListener('click', function() {
            backgroundMusic.pause();
            pauseBtn.style.display = 'none';
            playBtn.style.display = 'block';
            playBtn.classList.add('pulse');
        });

        // Ocultar la sugerencia de zoom despu√©s de 8 segundos
        setTimeout(() => {
            zoomHint.style.opacity = '0';
        }, 8000);

        // Permitir la reproducci√≥n al hacer clic en cualquier parte de la p√°gina
        document.body.addEventListener('click', function() {
            // Este evento vac√≠o ayuda a desbloquear la reproducci√≥n autom√°tica en algunos navegadores
        }, { once: true });

        // --- CONFIGURACI√ìN INICIAL DE THREE.JS ---
        
        const scene = new THREE.Scene();
        // C√°mara de perspectiva: (FOV, Aspecto, Cerca, Lejos)
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        // Controles de √ìrbita (Permite la interacci√≥n de zoom y rotaci√≥n)
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // Efecto de rotaci√≥n suave
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = false;
        controls.minDistance = 0.5;  // L√≠mite de zoom m√°s cercano para poder ver la carta
        controls.maxDistance = 250; // L√≠mite de alejamiento
        
        camera.position.z = 100; // Posici√≥n inicial de la c√°mara
        
        // --- AYUDAS VISUALES: FUNCI√ìN PARA CREAR TEXTO Y CORAZONES ---
        
        /**
         * Crea un Sprite (una imagen 2D orientada a la c√°mara) con un texto renderizado en un Canvas.
         * Esta es la forma m√°s f√°cil de agregar texto en 3D en un solo archivo.
         */
        function createTextSprite(message, color = '#FFFFFF', size = 50, scaleFactor = 1) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            // Ajustar el tama√±o del canvas
            canvas.width = 512;
            canvas.height = 128; 

            // Configurar el contexto para dibujar el texto
            context.font = `bold ${size}px 'Inter', sans-serif`;
            context.fillStyle = color;
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.shadowColor = 'rgba(255, 0, 120, 0.8)';
            context.shadowBlur = 10;
            context.fillText(message, canvas.width / 2, canvas.height / 2);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ 
                map: texture, 
                transparent: true,
                depthTest: true
            });
            
            const sprite = new THREE.Sprite(material);
            
            // Escala del sprite en el espacio 3D
            const textLengthFactor = message.length < 5 ? 1 : Math.min(message.length / 5, 4);
            sprite.scale.set(30 * textLengthFactor * scaleFactor, 8 * scaleFactor, 1);
            
            return sprite;
        }

        // --- CREACI√ìN DE LA CARTA EN EL CENTRO ---
        
        function createLetterSprite() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            // Canvas m√°s grande para la carta
            canvas.width = 1024;
            canvas.height = 768;

            // Fondo de la carta
            context.fillStyle = 'rgba(30, 10, 50, 0.95)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Borde decorativo
            context.strokeStyle = 'rgba(255, 100, 180, 0.6)';
            context.lineWidth = 8;
            context.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);
            
            // T√≠tulo
            context.fillStyle = '#FFAACC';
            context.font = 'bold 40px Inter';
            context.textAlign = 'center';
            context.fillText('Para Ti', canvas.width / 2, 80);
            
            // Contenido de la carta
            context.fillStyle = '#FFFFFF';
            context.font = '18px Inter';
            context.textAlign = 'left';
            context.textBaseline = 'top';
            
            const letterText = [
                "Hay momentos que parecen peque√±os, pero guardan",
                "universos enteros. Hay miradas que, aunque breves,",
                "dibujan constelaciones en mi coraz√≥n. Y hay silencios",
                "que hablan m√°s que mil palabras, porque llevan todo",
                "lo que siento por ti.",
                "",
                "Cada recuerdo contigo es como una estrella que",
                "ilumina mis d√≠as, y cada risa tuya es un susurro que",
                "quiero escuchar una y otra vez. A veces me pierdo en",
                "pensamientos de nosotros, imaginando instantes donde",
                "todo parece perfecto, donde el tiempo se detiene y el",
                "mundo solo existe para que estemos juntos.",
                "",
                "No s√© si estas palabras llegan a describir todo lo que",
                "guardo dentro, pero s√© que te pienso, que te valoro y",
                "que, sin quererlo, ocupas un lugar importante en cada",
                "rinc√≥n de mi mente. Solo quer√≠a que lo supieras, que",
                "aunque no siempre lo diga, lo siento de verdad."
            ];
            
            let yPosition = 140;
            const lineHeight = 28;
            
            letterText.forEach(line => {
                context.fillText(line, 60, yPosition);
                yPosition += lineHeight;
            });
            
            // Firma
            context.fillStyle = '#FFAACC';
            context.font = 'italic 24px Inter';
            context.textAlign = 'right';
            context.fillText('Con todo mi cari√±o', canvas.width - 60, canvas.height - 60);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ 
                map: texture, 
                transparent: true,
                depthTest: true
            });
            
            const sprite = new THREE.Sprite(material);
            
            // Hacer la carta MUY peque√±a - solo 2 unidades de tama√±o
            sprite.scale.set(15, 11, 1);
            
            return sprite;
        }

        // --- CREACI√ìN DE OBJETOS DE LA GALAXIA ---

        const galaxyGroup = new THREE.Group();
        scene.add(galaxyGroup);

        // A. Campo de Estrellas de Fondo (Part√≠culas)
        function createStarField(count) {
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            
            for (let i = 0; i < count; i++) {
                // Posiciones aleatorias en una gran esfera o cubo
                const x = (Math.random() - 0.5) * 500;
                const y = (Math.random() - 0.5) * 500;
                const z = (Math.random() - 0.5) * 500;
                positions.push(x, y, z);
                
                // Colores aleatorios para algunas estrellas
                const color = new THREE.Color();
                if (Math.random() > 0.7) {
                    color.setHSL(Math.random(), 0.8, 0.7 + Math.random() * 0.3);
                } else {
                    color.setHSL(0.6, 0.5, 0.8 + Math.random() * 0.2);
                }
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.7,
                sizeAttenuation: true, // Las estrellas se ven m√°s peque√±as al alejarse
                vertexColors: true,
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending // Efecto de brillo
            });

            const starField = new THREE.Points(geometry, material);
            scene.add(starField);
        }
        createStarField(8000); // Crea 8000 estrellas de fondo

        // B. Crear y colocar la CARTA en el CENTRO exacto
        const letterSprite = createLetterSprite();
        letterSprite.position.set(0, 0, 0); // Posici√≥n exacta en el centro
        galaxyGroup.add(letterSprite);

        // C. Mensajes y Corazones Flotantes alrededor de la carta
        const numTexts = 100;
        const radius = 80; // Radio de la esfera donde se distribuir√°n los mensajes

        for (let i = 0; i < numTexts; i++) {
            const message = messages[i % messages.length];
            
            let color = '#FFFFFF';
            let scale = 1;
            
            if (message.includes('‚ù§Ô∏è')) {
                color = '#FF4488'; // Rosado para los corazones
                scale = 1.5; // Corazones m√°s grandes
            } else if (message === 'TE AMO' || message === 'Mi Coraz√≥n' || message === 'Encantado') {
                color = '#FFAACC'; // Blanco rosado para los mensajes principales
                scale = 2.2; // Mensajes principales m√°s grandes
            } else if (message.length > 10) {
                scale = 0.8; // Mensajes largos m√°s peque√±os
            }

            const textSprite = createTextSprite(message, color, 45, scale);

            // Posici√≥n aleatoria en 3D (distribuci√≥n esf√©rica) alrededor del centro
            const angle = Math.random() * Math.PI * 2;
            const y = Math.random() * 2 - 1;
            const r = Math.sqrt(1 - y * y);
            
            textSprite.position.set(
                r * Math.cos(angle) * radius * (0.8 + Math.random() * 0.4),
                y * radius * (0.8 + Math.random() * 0.4),
                r * Math.sin(angle) * radius * (0.8 + Math.random() * 0.4)
            );

            // Guarda un valor de rotaci√≥n aleatorio para la animaci√≥n
            textSprite.userData.rotationSpeed = Math.random() * 0.001 + 0.0005;
            textSprite.userData.verticalSpeed = Math.random() * 0.005 + 0.005;
            textSprite.userData.startY = textSprite.position.y;
            textSprite.userData.rotationAxis = new THREE.Vector3(Math.random(), Math.random(), Math.random()).normalize();
            
            galaxyGroup.add(textSprite);
        }

        // --- FUNCI√ìN DE ANIMACI√ìN (LOOP PRINCIPAL) ---

        let clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();

            // Animaci√≥n de los mensajes flotantes (excepto la carta)
            galaxyGroup.children.forEach(child => {
                if (child.isSprite && child !== letterSprite) {
                    // Rotaci√≥n suave (como si estuvieran flotando en un campo de energ√≠a)
                    child.rotation.y += child.userData.rotationSpeed; 

                    // Movimiento vertical de vaiv√©n (flotaci√≥n)
                    child.position.y = child.userData.startY + Math.sin(Date.now() * 0.001 * child.userData.verticalSpeed) * 5;
                    
                    // Efecto de pulso s√≠ncrono con la m√∫sica (si est√° reproduci√©ndose)
                    if (!backgroundMusic.paused) {
                        const scaleFactor = 1 + Math.sin(Date.now() * 0.003) * 0.1;
                        child.scale.x = child.userData.originalScaleX * scaleFactor;
                        child.scale.y = child.userData.originalScaleY * scaleFactor;
                    }
                }
            });

            // La carta en el centro gira muy lentamente
            letterSprite.rotation.y += 0.0001;
            
            // Rotaci√≥n general de la galaxia para un efecto m√°s din√°mico
            galaxyGroup.rotation.y += 0.0002;
            
            // Actualiza los controles (necesario para el damping y la interacci√≥n)
            controls.update(); 
            
            // Renderiza la escena
            renderer.render(scene, camera);
        }

        // Guardar escalas originales para la animaci√≥n de pulso
        galaxyGroup.children.forEach(child => {
            if (child.isSprite && child !== letterSprite) {
                child.userData.originalScaleX = child.scale.x;
                child.userData.originalScaleY = child.scale.y;
            }
        });

        // --- MANEJO DE EVENTOS ---
        
        // Iniciar la animaci√≥n al cargar la ventana
        window.onload = function () {
            animate();
        }

        // Manejar el redimensionamiento de la ventana para que sea responsivo
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>